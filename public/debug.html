<!DOCTYPE html>
<html>
<head>
    <title>Quota Debug Tool</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { margin: 10px; padding: 10px 20px; font-size: 16px; }
        .success { background: #4CAF50; color: white; }
        .danger { background: #f44336; color: white; }
        .info { background: #2196F3; color: white; }
        #output { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>üõ†Ô∏è Fitness Trainer AI - Quota Debug Tool</h1>
    
    <div>
        <button class="danger" onclick="clearQuota()">üóëÔ∏è Clear All Quota Restrictions</button>
        <button class="success" onclick="forceAllow()">‚úÖ Force Allow All Requests</button>
        <button class="info" onclick="checkStatus()">üìä Check Current Status</button>
        <button class="info" onclick="inspectStorage()">üîç Inspect LocalStorage</button>
    </div>
    
    <div id="output">Ready to debug...</div>

    <script>
        function log(message) {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            output.innerHTML += `[${timestamp}] ${message}\n`;
            console.log(message);
        }

        function clearQuota() {
            try {
                localStorage.removeItem('gemini_quota_status');
                log('‚úÖ Quota status cleared from localStorage');
                
                // Also create a new clean status
                const cleanStatus = {
                    requestCount: 0,
                    lastReset: Date.now(),
                    dailyLimit: 999999,
                    isExceeded: false
                };
                localStorage.setItem('gemini_quota_status', JSON.stringify(cleanStatus));
                log('‚úÖ New clean quota status created');
            } catch (e) {
                log('‚ùå Error clearing quota: ' + e.message);
            }
        }

        function forceAllow() {
            try {
                const status = {
                    requestCount: 0,
                    lastReset: Date.now(),
                    dailyLimit: 999999,
                    isExceeded: false,
                    retryAfter: undefined,
                    serviceOverloaded: false,
                    lastOverloadTime: undefined
                };
                localStorage.setItem('gemini_quota_status', JSON.stringify(status));
                log('‚úÖ Forced all requests to be allowed (unlimited quota)');
            } catch (e) {
                log('‚ùå Error forcing allow: ' + e.message);
            }
        }

        function checkStatus() {
            try {
                const stored = localStorage.getItem('gemini_quota_status');
                if (!stored) {
                    log('‚ÑπÔ∏è No quota status found in localStorage');
                    return;
                }
                
                const status = JSON.parse(stored);
                log('üìä Current quota status:');
                log(`  Request Count: ${status.requestCount}`);
                log(`  Daily Limit: ${status.dailyLimit}`);
                log(`  Is Exceeded: ${status.isExceeded}`);
                log(`  Retry After: ${status.retryAfter ? new Date(status.retryAfter).toLocaleString() : 'None'}`);
                log(`  Service Overloaded: ${status.serviceOverloaded || false}`);
            } catch (e) {
                log('‚ùå Error checking status: ' + e.message);
            }
        }

        function inspectStorage() {
            log('üîç All localStorage keys:');
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.includes('quota') || key.includes('gemini')) {
                    const value = localStorage.getItem(key);
                    log(`  ${key}: ${value}`);
                }
            }
        }

        // Auto-clear on page load
        window.onload = function() {
            log('üöÄ Debug tool loaded - auto-clearing quota...');
            forceAllow();
        };
    </script>
</body>
</html>